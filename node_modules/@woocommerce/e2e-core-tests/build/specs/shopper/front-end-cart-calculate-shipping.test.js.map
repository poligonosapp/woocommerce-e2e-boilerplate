{"version":3,"sources":["/Users/ronrennick/Sites/solaris/woocommerce/packages/js/e2e-core-tests/src/specs/shopper/front-end-cart-calculate-shipping.test.js"],"names":["shopper","createSimpleProduct","uiUnblocked","selectOptionInSelect2","withRestApi","require","it","describe","beforeAll","config","firstProductPrice","has","get","secondProductPrice","fourProductPrice","twoProductsPrice","firstProductPriceWithFlatRate","fourProductPriceWithFlatRate","twoProductsPriceWithFlatRate","firstProductName","secondProductName","shippingZoneNameDE","shippingCountryDE","shippingZoneNameFR","shippingCountryFR","runCartCalculateShippingTest","firstProductId","secondProductId","resetSettingsGroupToDefault","addShippingZoneAndMethod","emptyCart","afterAll","deleteAllShippingZones","goToShop","addToCartFromShopPage","goToCart","expect","page","toClick","waitForSelector","toMatchElement","text","reload","waitUntil","setCartQuantity","module","exports"],"mappings":"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","sourcesContent":["/**\n * Internal dependencies\n */\nconst {\n\tshopper,\n\tcreateSimpleProduct,\n\tuiUnblocked,\n\tselectOptionInSelect2,\n\twithRestApi,\n} = require( '@woocommerce/e2e-utils' );\n\n/**\n * External dependencies\n */\nconst { it, describe, beforeAll } = require( '@jest/globals' );\n\nconst config = require( 'config' );\nconst firstProductPrice = config.has( 'products.simple.price' ) ? config.get( 'products.simple.price' ) : '9.99';\nconst secondProductPrice = '4.99';\nconst fourProductPrice = firstProductPrice * 4;\nvar twoProductsPrice = (+firstProductPrice) + (+secondProductPrice);\nvar firstProductPriceWithFlatRate = (+firstProductPrice) + (+5);\nvar fourProductPriceWithFlatRate = (+fourProductPrice) + (+5);\nvar twoProductsPriceWithFlatRate = (+twoProductsPrice) + (+5);\nconst firstProductName = 'First Product';\nconst secondProductName = 'Second Product';\nconst shippingZoneNameDE = 'Germany Free Shipping';\nconst shippingCountryDE = 'country:DE';\nconst shippingZoneNameFR = 'France Flat Local';\nconst shippingCountryFR = 'country:FR';\n\nconst runCartCalculateShippingTest = () => {\n\tdescribe('Cart Calculate Shipping', () => {\n\t\tlet firstProductId;\n\t\tlet secondProductId;\n\n\t\tbeforeAll(async () => {\n\t\t\tfirstProductId = await createSimpleProduct(firstProductName);\n\t\t\tsecondProductId = await createSimpleProduct(secondProductName, secondProductPrice);\n\n\t\t\tawait withRestApi.resetSettingsGroupToDefault( 'general', false );\n\n\t\t\t// Add a new shipping zone Germany with Free shipping\n\t\t\tawait withRestApi.addShippingZoneAndMethod(shippingZoneNameDE, shippingCountryDE, ' ', 'free_shipping', '', [], false );\n\n\t\t\t// Add a new shipping zone for France with Flat rate & Local pickup\n\t\t\tawait withRestApi.addShippingZoneAndMethod(shippingZoneNameFR, shippingCountryFR, ' ', 'flat_rate', '5', ['local_pickup'], false );\n\n\t\t\tawait shopper.emptyCart();\n\t\t});\n\n\t\tafterAll(async () => {\n\t\t\tawait withRestApi.deleteAllShippingZones( false );\n\t\t});\n\n\t\tit('allows customer to calculate Free Shipping if in Germany', async () => {\n\t\t\tawait shopper.goToShop();\n\t\t\tawait shopper.addToCartFromShopPage( firstProductId );\n\t\t\tawait shopper.goToCart();\n\n\t\t\t// Set shipping country to Germany\n\t\t\tawait expect(page).toClick('a.shipping-calculator-button');\n\t\t\tawait expect(page).toClick('#select2-calc_shipping_country-container');\n\t\t\tawait selectOptionInSelect2('Germany');\n\t\t\tawait expect(page).toClick('button[name=\"calc_shipping\"]');\n\t\t\tawait uiUnblocked();\n\n\t\t\t// Verify shipping costs\n\t\t\tawait page.waitForSelector('.order-total');\n\t\t\tawait expect(page).toMatchElement('.shipping ul#shipping_method > li', {text: 'Free shipping'});\n\t\t\tawait expect(page).toMatchElement('.order-total .amount', {text: `$${firstProductPrice}`});\n\t\t});\n\n\t\tit('allows customer to calculate Flat rate and Local pickup if in France', async () => {\n\t\t\tawait page.reload( { waitUntil: ['networkidle0', 'domcontentloaded'] } );\n\n\t\t\t// Set shipping country to France\n\t\t\tawait expect(page).toClick('a.shipping-calculator-button');\n\t\t\tawait expect(page).toClick('#select2-calc_shipping_country-container');\n\t\t\tawait selectOptionInSelect2('France');\n\t\t\tawait expect(page).toClick('button[name=\"calc_shipping\"]');\n\t\t\tawait uiUnblocked();\n\n\t\t\t// Verify shipping costs\n\t\t\tawait page.waitForSelector('.order-total');\n\t\t\tawait expect(page).toMatchElement('.shipping .amount', {text: '$5.00'});\n\t\t\tawait expect(page).toMatchElement('.order-total .amount', {text: `$${firstProductPriceWithFlatRate}`});\n\t\t});\n\n\t\tit('should show correct total cart price after updating quantity', async () => {\n\t\t\tawait shopper.setCartQuantity(firstProductName, 4);\n\t\t\tawait expect(page).toClick('button', {text: 'Update cart'});\n\t\t\tawait uiUnblocked();\n\t\t\tawait expect(page).toMatchElement('.order-total .amount', {text: `$${fourProductPriceWithFlatRate}`});\n\t\t});\n\n\t\tit('should show correct total cart price with 2 products and flat rate', async () => {\n\t\t\tawait shopper.goToShop();\n\t\t\tawait shopper.addToCartFromShopPage( secondProductId );\n\t\t\tawait shopper.goToCart();\n\n\t\t\tawait shopper.setCartQuantity(firstProductName, 1);\n\t\t\tawait expect(page).toClick('button', {text: 'Update cart'});\n\t\t\tawait uiUnblocked();\n\t\t\tawait page.waitForSelector('.order-total');\n\t\t\tawait expect(page).toMatchElement('.shipping .amount', {text: '$5.00'});\n\t\t\tawait expect(page).toMatchElement('.order-total .amount', {text: `$${twoProductsPriceWithFlatRate}`});\n\t\t});\n\n\t\tit('should show correct total cart price with 2 products without flat rate', async () => {\n\t\t\tawait page.reload( { waitUntil: ['networkidle0', 'domcontentloaded'] } );\n\n\t\t\t// Set shipping country to Spain\n\t\t\tawait expect(page).toClick('a.shipping-calculator-button');\n\t\t\tawait expect(page).toClick('#select2-calc_shipping_country-container');\n\t\t\tawait selectOptionInSelect2('Spain');\n\t\t\tawait expect(page).toClick('button[name=\"calc_shipping\"]');\n\t\t\tawait uiUnblocked();\n\n\t\t\t// Verify shipping costs\n\t\t\tawait page.waitForSelector('.order-total');\n\t\t\tawait expect(page).toMatchElement('.order-total .amount', {text: `$${twoProductsPrice}`});\n\t\t});\n\t});\n};\n\nmodule.exports = runCartCalculateShippingTest;\n"]}