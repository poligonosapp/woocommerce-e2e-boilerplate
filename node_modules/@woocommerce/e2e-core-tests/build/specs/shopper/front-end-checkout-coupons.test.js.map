{"version":3,"sources":["/Users/ronrennick/Sites/solaris/woocommerce/packages/js/e2e-core-tests/src/specs/shopper/front-end-checkout-coupons.test.js"],"names":["shopper","createSimpleProduct","uiUnblocked","applyCoupon","removeCoupon","waitForSelectorWithoutThrow","require","getCouponId","getCouponsTable","it","describe","beforeAll","runCheckoutApplyCouponsTest","productId","emptyCart","goToShop","addToCartFromShopPage","goToCheckout","each","couponType","cartDiscount","orderTotal","coupon","expect","page","toMatchElement","text","waitForSelector","couponId","module","exports"],"mappings":"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","sourcesContent":["/**\n * Internal dependencies\n */\nconst {\n\tshopper,\n\tcreateSimpleProduct,\n\tuiUnblocked,\n\tapplyCoupon,\n\tremoveCoupon,\n\twaitForSelectorWithoutThrow,\n} = require( '@woocommerce/e2e-utils' );\nconst { getCouponId, getCouponsTable } = require( '../utils/coupons' );\n\n/**\n * External dependencies\n */\nconst { it, describe, beforeAll } = require( '@jest/globals' );\n\n\nconst runCheckoutApplyCouponsTest = () => {\n\tdescribe('Checkout coupons', () => {\n\t\tlet productId;\n\n\t\tbeforeAll(async () => {\n\t\t\tproductId = await createSimpleProduct();\n\t\t\tawait shopper.emptyCart();\n\t\t\tawait shopper.goToShop();\n\t\t\tawait waitForSelectorWithoutThrow( '.add_to_cart_button' );\n\t\t\tawait shopper.addToCartFromShopPage( productId );\n\t\t\tawait uiUnblocked();\n\t\t\tawait shopper.goToCheckout();\n\t\t});\n\n\t\tit.each( getCouponsTable() )( 'allows checkout to apply %s coupon', async ( couponType, cartDiscount, orderTotal ) => {\n\t\t\tconst coupon = await getCouponId( couponType );\n\t\t\tawait applyCoupon(coupon);\n\t\t\tawait expect(page).toMatchElement('.woocommerce-message', { text: 'Coupon code applied successfully.' });\n\n\t\t\t// Wait for page to expand total calculations to avoid flakyness\n\t\t\tawait page.waitForSelector('.order-total');\n\n\t\t\t// Verify discount applied and order total\n\t\t\tawait expect(page).toMatchElement('.cart-discount .amount', cartDiscount);\n\t\t\tawait expect(page).toMatchElement('.order-total .amount', orderTotal);\n\t\t\tawait removeCoupon(coupon);\n\t\t});\n\n\t\tit('prevents checkout applying same coupon twice', async () => {\n\t\t\tconst couponId = await getCouponId( 'fixed cart' );\n\t\t\tawait applyCoupon( couponId );\n\t\t\tawait expect(page).toMatchElement('.woocommerce-message', {text: 'Coupon code applied successfully.'});\n\t\t\tawait applyCoupon( couponId );\n\t\t\t// Verify only one discount applied\n\t\t\t// This is a work around for Puppeteer inconsistently finding 'Coupon code already applied'\n\t\t\tawait expect(page).toMatchElement('.cart-discount .amount', {text: '$5.00'});\n\t\t\tawait expect(page).toMatchElement('.order-total .amount', {text: '$4.99'});\n\t\t});\n\n\t\tit('allows checkout to apply multiple coupons', async () => {\n\t\t\tawait applyCoupon( await getCouponId( 'fixed product' ) );\n\t\t\tawait expect(page).toMatchElement('.woocommerce-message', {text: 'Coupon code applied successfully.'});\n\n\t\t\t// Verify discount applied and order total\n\t\t\tawait page.waitForSelector('.order-total');\n\t\t\tawait expect(page).toMatchElement('.order-total .amount', {text: '$0.00'});\n\t\t});\n\n\t\tit('restores checkout total when coupons are removed', async () => {\n\t\t\tawait removeCoupon( await getCouponId( 'fixed cart' ) );\n\t\t\tawait removeCoupon( await getCouponId( 'fixed product' ) );\n\t\t\tawait expect(page).toMatchElement('.order-total .amount', {text: '$9.99'});\n\t\t});\n\t});\n};\n\nmodule.exports = runCheckoutApplyCouponsTest;\n"]}