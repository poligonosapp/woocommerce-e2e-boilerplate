{"version":3,"sources":["/Users/ronrennick/Sites/solaris/woocommerce/packages/js/e2e-core-tests/src/specs/merchant/wp-admin-settings-shipping-zones.test.js"],"names":["shopper","merchant","createSimpleProduct","addShippingZoneAndMethod","clearAndFillInput","selectOptionInSelect2","withRestApi","uiUnblocked","require","it","describe","beforeAll","config","simpleProductPrice","has","get","california","sanFranciscoZIP","shippingZoneNameUS","shippingZoneNameFL","shippingZoneNameSF","runAddNewShippingZoneTest","productId","deleteAllShippingZones","login","afterAll","logout","expect","page","toClick","text","goToShop","addToCartFromShopPage","goToCart","waitForSelector","toMatchElement","reload","removeFromCart","module","exports"],"mappings":"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","sourcesContent":["/**\n * Internal dependencies\n */\nconst {\n\tshopper,\n\tmerchant,\n\tcreateSimpleProduct,\n\taddShippingZoneAndMethod,\n\tclearAndFillInput,\n\tselectOptionInSelect2,\n\twithRestApi,\n\tuiUnblocked,\n} = require( '@woocommerce/e2e-utils' );\n\n/**\n * External dependencies\n */\nconst {\n\tit,\n\tdescribe,\n\tbeforeAll,\n} = require( '@jest/globals' );\n\nconst config = require( 'config' );\nconst simpleProductPrice = config.has( 'products.simple.price' ) ? config.get( 'products.simple.price' ) : '9.99';\nconst california = 'state:US:CA';\nconst sanFranciscoZIP = '94107';\nconst shippingZoneNameUS = 'US with Flat rate';\nconst shippingZoneNameFL = 'CA with Free shipping';\nconst shippingZoneNameSF = 'SF with Local pickup';\n\nconst runAddNewShippingZoneTest = () => {\n\tdescribe('WooCommerce Shipping Settings - Add new shipping zone', () => {\n\t\tlet productId;\n\n\t\tbeforeAll(async () => {\n\t\t\tproductId = await createSimpleProduct();\n\t\t\tawait withRestApi.deleteAllShippingZones( false );\n\t\t\tawait merchant.login();\n\t\t});\n\n\t\tafterAll( async () => {\n\t\t\tawait shopper.logout();\n\t\t} );\n\n\t\tit('add shipping zone for San Francisco with free Local pickup', async () => {\n\t\t\t// Add a new shipping zone for San Francisco 94107, CA, US with Local pickup\n\t\t\tawait addShippingZoneAndMethod(shippingZoneNameSF, california, sanFranciscoZIP, 'local_pickup');\n\t\t});\n\n\t\tit('add shipping zone for California with Free shipping', async () => {\n\t\t\t// Add a new shipping zone for CA, US with Free shipping\n\t\t\tawait addShippingZoneAndMethod(shippingZoneNameFL, california, ' ', 'free_shipping');\n\t\t});\n\n\t\tit('add shipping zone for the US with Flat rate', async () => {\n\t\t\t// Add a new shipping zone for the US with Flat rate\n\t\t\tawait addShippingZoneAndMethod(shippingZoneNameUS);\n\n\t\t\t// Set Flat rate cost\n\t\t\tawait expect(page).toClick('a.wc-shipping-zone-method-settings', {text: 'Flat rate'});\n\t\t\tawait clearAndFillInput('#woocommerce_flat_rate_cost', '10');\n\t\t\tawait expect(page).toClick('.wc-backbone-modal-main button#btn-ok');\n\t\t\tawait merchant.logout();\n\t\t});\n\n\t\tit('allows customer to pay for a Flat rate shipping method', async() => {\n\t\t\tawait shopper.login();\n\n\t\t\t// Add product to cart as a shopper\n\t\t\tawait shopper.goToShop();\n\t\t\tawait shopper.addToCartFromShopPage( productId );\n\t\t\tawait shopper.goToCart();\n\n\t\t\t// Set shipping country to United States (US)\n\t\t\tawait expect(page).toClick('a.shipping-calculator-button');\n\t\t\tawait expect(page).toClick('#select2-calc_shipping_country-container');\n\t\t\tawait selectOptionInSelect2('United States (US)');\n\n\t\t\t// Set shipping state to New York\n\t\t\tawait expect(page).toClick('#select2-calc_shipping_state-container');\n\t\t\tawait selectOptionInSelect2('New York');\n\t\t\tawait expect(page).toClick('button[name=\"calc_shipping\"]');\n\n\t\t\tawait uiUnblocked();\n\n\t\t\t// Verify shipping costs\n\t\t\tawait page.waitForSelector('.order-total');\n\t\t\tawait expect(page).toMatchElement('.shipping .amount', {text: '$10.00'});\n\t\t\tawait expect(page).toMatchElement('.order-total .amount', {text: `$1${simpleProductPrice}`});\n\t\t});\n\n\t\tit('allows customer to benefit from a Free shipping if in CA', async () => {\n\t\t\tawait page.reload();\n\n\t\t\t// Set shipping state to California\n\t\t\tawait expect(page).toClick('a.shipping-calculator-button');\n\t\t\tawait expect(page).toClick('#select2-calc_shipping_state-container');\n\t\t\tawait selectOptionInSelect2('California');\n\n\t\t\t// Set shipping postcode to 94000\n\t\t\tawait clearAndFillInput('#calc_shipping_postcode', '94000');\n\t\t\tawait expect(page).toClick('button[name=\"calc_shipping\"]');\n\n\t\t\tawait uiUnblocked();\n\n\t\t\t// Verify shipping method and cost\n\t\t\tawait page.waitForSelector('.order-total');\n\t\t\tawait expect(page).toMatchElement('.shipping ul#shipping_method > li', {text: 'Free shipping'});\n\t\t\tawait expect(page).toMatchElement('.order-total .amount', {text: `$${simpleProductPrice}`});\n\t\t});\n\n\t\tit('allows customer to benefit from a free Local pickup if in SF', async () => {\n\t\t\tawait page.reload();\n\n\t\t\t// Set shipping postcode to 94107\n\t\t\tawait expect(page).toClick('a.shipping-calculator-button');\n\t\t\tawait clearAndFillInput('#calc_shipping_postcode', '94107');\n\t\t\tawait expect(page).toClick('button[name=\"calc_shipping\"]');\n\n\t\t\tawait uiUnblocked();\n\n\t\t\t// Verify shipping method and cost\n\t\t\tawait page.waitForSelector('.order-total');\n\t\t\tawait expect(page).toMatchElement('.shipping ul#shipping_method > li', {text: 'Local pickup'});\n\t\t\tawait expect(page).toMatchElement('.order-total .amount', {text: `$${simpleProductPrice}`});\n\n\t\t\tawait shopper.removeFromCart( productId );\n\t\t});\n\t});\n};\n\nmodule.exports = runAddNewShippingZoneTest;\n"]}