{"version":3,"sources":["/Users/ronrennick/Sites/solaris/woocommerce/packages/js/e2e-core-tests/src/specs/merchant/wp-admin-order-refund-restock.test.js"],"names":["merchant","createOrder","createSimpleProduct","verifyCheckboxIsSet","uiUnblocked","evalAndClick","clickUpdateOrder","waitForSelector","require","clickAndWaitForSelector","buttonSelector","resultSelector","page","timeout","getRefundQuantityInputSelector","productName","runOrderRefundRestockTest","describe","it","noInventoryProductId","productToRestockId","trackInventory","remainingStock","orderId","status","lineItems","product_id","quantity","login","goToOrder","expect","toMatchElement","text","toClick","visible","toFill","$$eval","notes","every","note","textContent","match","toEqual","module","exports"],"mappings":"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","sourcesContent":["/**\n * Internal dependencies\n */\nconst {\n\tmerchant,\n\tcreateOrder,\n\tcreateSimpleProduct,\n\tverifyCheckboxIsSet,\n\tuiUnblocked,\n\tevalAndClick,\n\tclickUpdateOrder,\n\twaitForSelector,\n} = require( '@woocommerce/e2e-utils' );\n\n/**\n * Evaluate and click a button selector then wait for a result selector.\n * This is a work around for what appears to be intermittent delays in handling confirm dialogs.\n *\n * @param {string} buttonSelector\n * @param {string} resultSelector\n * @returns {Promise<void>}\n */\nconst clickAndWaitForSelector = async ( buttonSelector, resultSelector ) => {\n\tawait evalAndClick( buttonSelector );\n\tawait waitForSelector( page, resultSelector, {\n\t\ttimeout: 5000,\n\t} );\n};\n\nconst getRefundQuantityInputSelector = ( productName ) =>\n\t`td.name[data-sort-value=\"${ productName }\"] ~ td.quantity input.refund_order_item_qty`;\n\nconst runOrderRefundRestockTest = () => {\n\tdescribe( 'WooCommerce Orders > Refund and restock an order item', () => {\n\t\t// See: https://github.com/woocommerce/woocommerce/issues/30618\n\t\tit( 'Can update order after refunding item without automatic stock adjustment', async () => {\n\t\t\tconst noInventoryProductId = await createSimpleProduct();\n\t\t\tconst productToRestockId = await createSimpleProduct(\n\t\t\t\t'Product with Stock',\n\t\t\t\t'10',\n\t\t\t\t{\n\t\t\t\t\ttrackInventory: true,\n\t\t\t\t\tremainingStock: 10,\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tconst orderId = await createOrder( {\n\t\t\t\tstatus: 'completed',\n\t\t\t\tlineItems: [\n\t\t\t\t\t{\n\t\t\t\t\t\tproduct_id: noInventoryProductId,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tproduct_id: productToRestockId,\n\t\t\t\t\t\tquantity: 2,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t} );\n\n\t\t\tawait merchant.login();\n\t\t\tawait merchant.goToOrder( orderId );\n\n\t\t\t// Get the currency symbol for the store's selected currency\n\t\t\tawait page.waitForSelector( '.woocommerce-Price-currencySymbol' );\n\n\t\t\t// Verify stock reduction system note was added\n\t\t\tawait expect( page ).toMatchElement( '.system-note', {\n\t\t\t\ttext: `Stock levels reduced: Product with Stock (#${ productToRestockId }) 10→8`,\n\t\t\t} );\n\n\t\t\t// Click the Refund button\n\t\t\tawait expect( page ).toClick( 'button.refund-items' );\n\n\t\t\t// Verify the refund section shows\n\t\t\tawait page.waitForSelector( 'div.wc-order-refund-items', {\n\t\t\t\tvisible: true,\n\t\t\t} );\n\t\t\tawait verifyCheckboxIsSet( '#restock_refunded_items' );\n\n\t\t\t// Initiate a refund\n\t\t\tawait expect( page ).toFill(\n\t\t\t\tgetRefundQuantityInputSelector( 'Product with Stock' ),\n\t\t\t\t'2'\n\t\t\t);\n\t\t\tawait expect( page ).toFill( '#refund_reason', 'No longer wanted' );\n\n\t\t\tawait clickAndWaitForSelector(\n\t\t\t\t'.do-manual-refund',\n\t\t\t\t'.quantity .refunded'\n\t\t\t);\n\t\t\tawait uiUnblocked();\n\n\t\t\t// Verify restock system note was added\n\t\t\tawait expect( page ).toMatchElement( '.system-note', {\n\t\t\t\ttext: `Item #${ productToRestockId } stock increased from 8 to 10.`,\n\t\t\t} );\n\n\t\t\t// Update the order.\n\t\t\tawait clickUpdateOrder( 'Order updated.' );\n\n\t\t\t// Verify that inventory wasn't modified.\n\t\t\t// For some reason using expect().not.toMatchElement() did not work for this case.\n\t\t\texpect(\n\t\t\t\tawait page.$$eval( '.note', ( notes ) =>\n\t\t\t\t\tnotes.every(\n\t\t\t\t\t\t( note ) =>\n\t\t\t\t\t\t\t! note.textContent.match(\n\t\t\t\t\t\t\t\t/Adjusted stock: Product with Stock \\(10→8\\)/\n\t\t\t\t\t\t\t)\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t).toEqual( true );\n\t\t} );\n\t} );\n};\n\nmodule.exports = runOrderRefundRestockTest;\n"]}