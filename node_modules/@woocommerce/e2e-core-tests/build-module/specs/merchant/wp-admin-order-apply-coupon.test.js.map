{"version":3,"sources":["/Users/ronrennick/Sites/solaris/woocommerce/packages/js/e2e-core-tests/src/specs/merchant/wp-admin-order-apply-coupon.test.js"],"names":["createSimpleProduct","createCoupon","uiUnblocked","evalAndClick","merchant","createOrder","utils","require","config","simpleProductPrice","has","get","discountedPrice","couponDialogMessage","couponCode","orderId","productId","runOrderApplyCouponTest","describe","beforeAll","status","login","goToOrder","page","removeAllListeners","expect","Number","toBeGreaterThan","it","waitForSelector","couponDialog","toDisplayDialog","message","toMatch","accept","toMatchElement","text","toLowerCase","waitForTimeout","not","module","exports"],"mappings":"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","sourcesContent":["/**\n * Internal dependencies\n */\nconst {\n\tcreateSimpleProduct,\n\tcreateCoupon,\n\tuiUnblocked,\n\tevalAndClick,\n\tmerchant,\n\tcreateOrder,\n\tutils,\n} = require( '@woocommerce/e2e-utils' );\n\nconst config = require( 'config' );\nconst simpleProductPrice = config.has('products.simple.price') ? config.get('products.simple.price') : '9.99';\nconst discountedPrice = simpleProductPrice - 5.00;\n\nconst couponDialogMessage = 'Enter a coupon code to apply. Discounts are applied to line totals, before taxes.';\n\nlet couponCode;\nlet orderId;\nlet productId;\n\nconst runOrderApplyCouponTest = () => {\n\tdescribe('WooCommerce Orders > Apply coupon', () => {\n\t\tbeforeAll(async () => {\n\t\t\tproductId = await createSimpleProduct();\n\t\t\tcouponCode = await createCoupon();\n\t\t\torderId = await createOrder( { productId, status: 'pending' } );\n\n\t\t\tawait merchant.login();\n\t\t\tawait merchant.goToOrder( orderId );\n\t\t\tawait page.removeAllListeners('dialog');\n\n\t\t\t// Make sure the simple product price is greater than the coupon amount\n\t\t\tawait expect(Number(simpleProductPrice)).toBeGreaterThan(5.00);\n\t\t} );\n\n\t\tit('can apply a coupon', async () => {\n\t\t\tawait page.waitForSelector('button.add-coupon');\n\t\t\tconst couponDialog = await expect(page).toDisplayDialog(async () => {\n\t\t\t\tawait evalAndClick('button.add-coupon');\n\t\t\t});\n\t\t\texpect(couponDialog.message()).toMatch(couponDialogMessage);\n\n\t\t\t// Accept the dialog with the coupon code\n\t\t\tawait couponDialog.accept(couponCode);\n\t\t\tawait uiUnblocked();\n\n\t\t\t// Verify the coupon list is showing\n\t\t\tawait page.waitForSelector('.wc-used-coupons');\n\t\t\tawait expect(page).toMatchElement('.wc_coupon_list', { text: 'Coupon(s)' });\n\t\t\tawait expect(page).toMatchElement('.wc_coupon_list li.code.editable', { text: couponCode.toLowerCase() });\n\n\t\t\t// Check that the coupon has been applied\n\t\t\tawait expect(page).toMatchElement('.wc-order-item-discount', { text: '5.00' });\n\t\t\tawait expect(page).toMatchElement('.line_cost > .view > .woocommerce-Price-amount', { text: discountedPrice });\n\t\t});\n\n\t\tit('can remove a coupon', async () => {\n\t\t\t// Make sure we have a coupon on the page to use\n\t\t\tawait page.waitForSelector('.wc-used-coupons');\n\t\t\tawait expect(page).toMatchElement('.wc_coupon_list li.code.editable', { text: couponCode.toLowerCase() });\n\t\t\tawait evalAndClick( 'a.remove-coupon' );\n\n\t\t\tawait uiUnblocked();\n\n\t\t\tawait utils.waitForTimeout( 2000 ); // to avoid flakyness\n\n\t\t\t// Verify the coupon pricing has been removed\n\t\t\tawait expect(page).not.toMatchElement('.wc_coupon_list li.code.editable', { text: couponCode.toLowerCase() });\n\t\t\tawait expect(page).not.toMatchElement('.wc-order-item-discount', { text: '5.00' });\n\t\t\tawait expect(page).not.toMatchElement('.line-cost .view .woocommerce-Price-amount', { text: discountedPrice });\n\n\t\t\t// Verify the original price is the order total\n\t\t\tawait expect(page).toMatchElement('.line_cost > .view > .woocommerce-Price-amount', { text: simpleProductPrice });\n\t\t});\n\n\t});\n\n};\n\nmodule.exports = runOrderApplyCouponTest;\n"]}