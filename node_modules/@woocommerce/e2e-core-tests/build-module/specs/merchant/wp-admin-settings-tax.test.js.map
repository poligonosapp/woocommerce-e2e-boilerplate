{"version":3,"sources":["/Users/ronrennick/Sites/solaris/woocommerce/packages/js/e2e-core-tests/src/specs/merchant/wp-admin-settings-tax.test.js"],"names":["merchant","clearAndFillInput","setCheckbox","settingsPageSaveChanges","uiUnblocked","verifyCheckboxIsSet","verifyValueOfInputField","require","it","describe","beforeAll","runTaxSettingsTest","login","openSettings","expect","page","toMatchElement","text","Promise","all","toClick","toSelect","toFill","$$","toHaveLength","not","module","exports"],"mappings":"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","sourcesContent":["/**\n * Internal dependencies\n */\nconst {\n\tmerchant,\n\tclearAndFillInput,\n\tsetCheckbox,\n\tsettingsPageSaveChanges,\n\tuiUnblocked,\n\tverifyCheckboxIsSet,\n\tverifyValueOfInputField,\n} = require( '@woocommerce/e2e-utils' );\n\n/**\n * External dependencies\n */\nconst {\n\tit,\n\tdescribe,\n\tbeforeAll,\n} = require( '@jest/globals' );\n\nconst runTaxSettingsTest = () => {\n\tdescribe('WooCommerce Tax Settings', () => {\n\t\tbeforeAll(async () => {\n\t\t\tawait merchant.login();\n\t\t});\n\n\t\tit('can enable tax calculation', async () => {\n\t\t\t// Go to general settings page\n\t\t\tawait merchant.openSettings('general');\n\n\t\t\t// Make sure the general tab is active\n\t\t\tawait expect(page).toMatchElement('a.nav-tab-active', {text: 'General'});\n\n\t\t\t// Enable tax calculation\n\t\t\tawait setCheckbox('input[name=\"woocommerce_calc_taxes\"]');\n\t\t\tawait settingsPageSaveChanges();\n\n\t\t\t// Verify that settings have been saved\n\t\t\tawait Promise.all([\n\t\t\t\texpect(page).toMatchElement('#message', {text: 'Your settings have been saved.'}),\n\t\t\t\tverifyCheckboxIsSet('#woocommerce_calc_taxes'),\n\t\t\t]);\n\n\t\t\t// Verify that tax settings are now present\n\t\t\tawait expect(page).toMatchElement('a.nav-tab', {text: 'Tax'});\n\t\t});\n\n\t\tit('can set tax options', async () => {\n\t\t\t// Go to tax settings page\n\t\t\tawait merchant.openSettings('tax');\n\n\t\t\t// Make sure the tax tab is active\n\t\t\tawait expect(page).toMatchElement('a.nav-tab-active', {text: 'Tax'});\n\n\t\t\t// Prices exclusive of tax\n\t\t\tawait expect(page).toClick('input[name=\"woocommerce_prices_include_tax\"][value=\"no\"]');\n\t\t\t// Tax based on customer shipping address\n\t\t\tawait expect(page).toSelect('#woocommerce_tax_based_on', 'Customer shipping address');\n\t\t\t// Standard tax class for shipping\n\t\t\tawait expect(page).toSelect('#woocommerce_shipping_tax_class', 'Standard');\n\t\t\t// Leave rounding unchecked (no-op)\n\t\t\t// Display prices excluding tax\n\t\t\tawait expect(page).toSelect('#woocommerce_tax_display_shop', 'Excluding tax');\n\t\t\t// Display prices including tax in cart and at checkout\n\t\t\tawait expect(page).toSelect('#woocommerce_tax_display_cart', 'Including tax');\n\t\t\t// Display a single tax total\n\t\t\tawait expect(page).toSelect('#woocommerce_tax_total_display', 'As a single total');\n\n\t\t\tawait settingsPageSaveChanges();\n\n\t\t\t// Verify that settings have been saved\n\t\t\tawait Promise.all([\n\t\t\t\texpect(page).toMatchElement('#message', {text: 'Your settings have been saved.'}),\n\t\t\t\tverifyValueOfInputField('input[name=\"woocommerce_prices_include_tax\"][value=\"no\"]', 'no'),\n\t\t\t\texpect(page).toMatchElement('#woocommerce_tax_based_on', {text: 'Customer shipping address'}),\n\t\t\t\texpect(page).toMatchElement('#woocommerce_shipping_tax_class', {text: 'Standard'}),\n\t\t\t\texpect(page).toMatchElement('#woocommerce_tax_display_shop', {text: 'Excluding tax'}),\n\t\t\t\texpect(page).toMatchElement('#woocommerce_tax_display_cart', {text: 'Including tax'}),\n\t\t\t\texpect(page).toMatchElement('#woocommerce_tax_total_display', {text: 'As a single total'}),\n\t\t\t]);\n\t\t});\n\n\t\tit('can add tax classes', async () => {\n\t\t\t// Go to tax settings page\n\t\t\tawait merchant.openSettings('tax');\n\n\t\t\t// Make sure the tax tab is active\n\t\t\tawait expect(page).toMatchElement('a.nav-tab-active', {text: 'Tax'});\n\n\t\t\t// Remove additional tax classes\n\t\t\tawait clearAndFillInput('#woocommerce_tax_classes', '');\n\t\t\tawait settingsPageSaveChanges();\n\n\t\t\t// Verify that settings have been saved\n\t\t\tawait Promise.all([\n\t\t\t\texpect(page).toMatchElement('#message', {text: 'Your settings have been saved.'}),\n\t\t\t\texpect(page).toMatchElement('#woocommerce_tax_classes', {text: ''}),\n\t\t\t]);\n\n\t\t\t// Add a \"fancy\" tax class\n\t\t\tawait clearAndFillInput('#woocommerce_tax_classes', 'Fancy');\n\t\t\tawait settingsPageSaveChanges();\n\n\t\t\t// Verify that settings have been saved\n\t\t\tawait Promise.all([\n\t\t\t\texpect(page).toMatchElement('#message', {text: 'Your settings have been saved.'}),\n\t\t\t\texpect(page).toMatchElement('ul.subsubsub > li > a', {text: 'Fancy rates'}),\n\t\t\t]);\n\t\t});\n\n\t\tit('can set rate settings', async () => {\n\t\t\t// Go to \"fancy\" rates tax settings page\n\t\t\tawait merchant.openSettings('tax', 'fancy');\n\n\t\t\t// Make sure the tax tab is active, with the \"fancy\" subsection\n\t\t\tawait expect(page).toMatchElement('a.nav-tab-active', {text: 'Tax'});\n\t\t\tawait expect(page).toMatchElement('ul.subsubsub > li > a.current', {text: 'Fancy rates'});\n\n\t\t\t// Create a state tax\n\t\t\tawait expect(page).toClick('.wc_tax_rates a.insert');\n\t\t\tawait expect(page).toFill('input[name^=\"tax_rate_country[new-0\"]', 'US');\n\t\t\tawait expect(page).toFill('input[name^=\"tax_rate_state[new-0\"]', 'CA');\n\t\t\tawait expect(page).toFill('input[name^=\"tax_rate[new-0\"]', '7.5');\n\t\t\tawait expect(page).toFill('input[name^=\"tax_rate_name[new-0\"]', 'CA State Tax');\n\n\t\t\t// Create a federal tax\n\t\t\tawait expect(page).toClick('.wc_tax_rates a.insert');\n\t\t\tawait expect(page).toFill('input[name^=\"tax_rate_country[new-1\"]', 'US');\n\t\t\tawait expect(page).toFill('input[name^=\"tax_rate[new-1\"]', '1.5');\n\t\t\tawait expect(page).toFill('input[name^=\"tax_rate_priority[new-1\"]', '2');\n\t\t\tawait expect(page).toFill('input[name^=\"tax_rate_name[new-1\"]', 'Federal Tax');\n\t\t\tawait expect(page).toClick('input[name^=\"tax_rate_shipping[new-1\"]');\n\n\t\t\t// Save changes (AJAX here)\n\t\t\tawait expect(page).toClick('button.woocommerce-save-button');\n\t\t\tawait uiUnblocked();\n\n\t\t\t// Verify 2 tax rates\n\t\t\texpect(await page.$$('#rates tr')).toHaveLength(2);\n\n\t\t\t// Delete federal rate\n\t\t\tawait expect(page).toClick('#rates tr:nth-child(2) input');\n\t\t\tawait expect(page).toClick('.wc_tax_rates a.remove_tax_rates');\n\n\t\t\t// Save changes (AJAX here)\n\t\t\tawait expect(page).toClick('button.woocommerce-save-button');\n\t\t\tawait uiUnblocked();\n\n\t\t\t// Verify 1 rate\n\t\t\texpect(await page.$$('#rates tr')).toHaveLength(1);\n\t\t\tawait expect(page).toMatchElement(\n\t\t\t\t'#rates tr:first-of-type input[name^=\"tax_rate_state\"][value=\"CA\"]'\n\t\t\t);\n\t\t});\n\n\t\tit('can remove tax classes', async () => {\n\t\t\t// Go to tax settings page\n\t\t\tawait merchant.openSettings('tax');\n\n\t\t\t// Make sure the tax tab is active\n\t\t\tawait expect(page).toMatchElement('a.nav-tab-active', {text: 'Tax'});\n\n\t\t\t// Remove \"fancy\" tax class\n\t\t\tawait clearAndFillInput('#woocommerce_tax_classes', ' ');\n\t\t\tawait settingsPageSaveChanges();\n\n\t\t\t// Verify that settings have been saved\n\t\t\tawait Promise.all([\n\t\t\t\texpect(page).toMatchElement('#message', {text: 'Your settings have been saved.'}),\n\t\t\t\texpect(page).not.toMatchElement('ul.subsubsub > li > a', {text: 'Fancy rates'}),\n\t\t\t]);\n\t\t});\n\t});\n};\n\nmodule.exports = runTaxSettingsTest;\n"]}