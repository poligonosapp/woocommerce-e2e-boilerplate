{"version":3,"sources":["/Users/ronrennick/Sites/solaris/woocommerce/packages/js/e2e-core-tests/src/specs/shopper/front-end-checkout.test.js"],"names":["shopper","merchant","withRestApi","createSimpleProduct","uiUnblocked","require","it","describe","beforeAll","afterAll","config","simpleProductName","get","singleProductPrice","has","twoProductPrice","threeProductPrice","fourProductPrice","fiveProductPrice","guestOrderId","customerOrderId","runCheckoutPageTest","productId","resetSettingsGroupToDefault","addShippingZoneAndMethod","updateSettingOption","value","updatePaymentGateway","enabled","deleteAllShippingZones","goToShop","addToCartFromShopPage","goToCheckout","productIsInCheckout","expect","page","toClick","text","fillBillingDetails","evaluate","document","querySelector","click","fillShippingDetails","toMatchElement","placeOrder","toMatch","orderReceivedHtmlElement","$","orderReceivedText","element","textContent","split","toString","login","verifyOrder","module","exports"],"mappings":"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","sourcesContent":["/**\n * Internal dependencies\n */\nconst {\n\tshopper,\n\tmerchant,\n\twithRestApi,\n\tcreateSimpleProduct,\n\tuiUnblocked,\n} = require( '@woocommerce/e2e-utils' );\n\n/**\n * External dependencies\n */\nconst { it, describe, beforeAll, afterAll } = require( '@jest/globals' );\n\nconst config = require( 'config' );\nconst simpleProductName = config.get( 'products.simple.name' );\nconst singleProductPrice = config.has('products.simple.price') ? config.get('products.simple.price') : '9.99';\nconst twoProductPrice = singleProductPrice * 2;\nconst threeProductPrice = singleProductPrice * 3;\nconst fourProductPrice = singleProductPrice * 4;\nconst fiveProductPrice = singleProductPrice * 5;\n\nlet guestOrderId;\nlet customerOrderId;\n\nconst runCheckoutPageTest = () => {\n\tlet productId;\n\n\tdescribe('Checkout page', () => {\n\t\tbeforeAll(async () => {\n\t\t\tproductId = await createSimpleProduct();\n\t\t\tawait withRestApi.resetSettingsGroupToDefault( 'general', false );\n\t\t\tawait withRestApi.resetSettingsGroupToDefault( 'products', false );\n\t\t\tawait withRestApi.resetSettingsGroupToDefault( 'tax', false );\n\n\t\t\t// Set free shipping within California\n\t\t\tawait withRestApi.addShippingZoneAndMethod('Free Shipping CA', 'state:US:CA', '', 'free_shipping', '', [], false );\n\n\t\t\t// Set base location with state CA.\n\t\t\tawait withRestApi.updateSettingOption( 'general', 'woocommerce_default_country', { value: 'US:CA' } );\n\n\t\t\t// Sell to all countries\n\t\t\tawait withRestApi.updateSettingOption( 'general', 'woocommerce_allowed_countries', { value: 'all' } );\n\n\t\t\t// Set currency to USD\n\t\t\tawait withRestApi.updateSettingOption( 'general', 'woocommerce_currency', { value: 'USD' } );\n\t\t\t// Tax calculation should have been enabled by another test - no-op\n\n\t\t\t// Enable BACS payment method\n\t\t\tawait withRestApi.updatePaymentGateway( 'bacs', { enabled: true }, false );\n\n\t\t\t// Enable COD payment method\n\t\t\tawait withRestApi.updatePaymentGateway( 'cod', { enabled: true }, false );\n\t\t});\n\n\t\tafterAll(async () => {\n\t\t\tawait withRestApi.deleteAllShippingZones( false );\n\t\t});\n\n\t\tit('should display cart items in order review', async () => {\n\t\t\tawait shopper.goToShop();\n\t\t\tawait shopper.addToCartFromShopPage( productId );\n\t\t\tawait shopper.goToCheckout();\n\t\t\tawait shopper.productIsInCheckout(simpleProductName, `1`, singleProductPrice, singleProductPrice);\n\t\t});\n\n\t\tit('allows customer to choose available payment methods', async () => {\n\t\t\tawait shopper.goToShop();\n\t\t\tawait shopper.addToCartFromShopPage( productId );\n\t\t\tawait shopper.goToCheckout();\n\t\t\tawait shopper.productIsInCheckout(simpleProductName, `2`, twoProductPrice, twoProductPrice);\n\n\t\t\tawait expect(page).toClick('.wc_payment_method label', {text: 'Direct bank transfer'});\n\t\t\tawait expect(page).toClick('.wc_payment_method label', {text: 'Cash on delivery'});\n\t\t});\n\n\t\tit('allows customer to fill billing details', async () => {\n\t\t\tawait shopper.goToShop();\n\t\t\tawait shopper.addToCartFromShopPage( productId );\n\t\t\tawait shopper.goToCheckout();\n\t\t\tawait shopper.productIsInCheckout(simpleProductName, `3`, threeProductPrice, threeProductPrice);\n\t\t\tawait shopper.fillBillingDetails(config.get('addresses.customer.billing'));\n\t\t});\n\n\t\tit('allows customer to fill shipping details', async () => {\n\t\t\tawait shopper.goToShop();\n\t\t\tawait shopper.addToCartFromShopPage( productId );\n\t\t\tawait shopper.goToCheckout();\n\t\t\tawait shopper.productIsInCheckout(simpleProductName, `4`, fourProductPrice, fourProductPrice);\n\n\t\t\t// Select checkbox to ship to a different address\n\t\t\tawait page.evaluate(() => {\n\t\t\t\tdocument.querySelector('#ship-to-different-address-checkbox').click();\n\t\t\t});\n\t\t\tawait uiUnblocked();\n\n\t\t\tawait shopper.fillShippingDetails(config.get('addresses.customer.shipping'));\n\t\t});\n\n\t\tit('allows guest customer to place order', async () => {\n\t\t\tawait shopper.goToShop();\n\t\t\tawait shopper.addToCartFromShopPage( productId );\n\t\t\tawait shopper.goToCheckout();\n\t\t\tawait shopper.productIsInCheckout(simpleProductName, `5`, fiveProductPrice, fiveProductPrice);\n\t\t\tawait shopper.fillBillingDetails(config.get('addresses.customer.billing'));\n\n\t\t\tawait uiUnblocked();\n\n\t\t\tawait expect(page).toClick('.wc_payment_method label', {text: 'Cash on delivery'});\n\t\t\tawait expect(page).toMatchElement('.payment_method_cod', {text: 'Pay with cash upon delivery.'});\n\t\t\tawait uiUnblocked();\n\t\t\tawait shopper.placeOrder();\n\n\t\t\tawait expect(page).toMatch('Order received');\n\n\t\t\t// Get order ID from the order received html element on the page\n\t\t\tlet orderReceivedHtmlElement = await page.$('.woocommerce-order-overview__order.order');\n\t\t\tlet orderReceivedText = await page.evaluate(element => element.textContent, orderReceivedHtmlElement);\n\t\t\tguestOrderId = orderReceivedText.split(/(\\s+)/)[6].toString();\n\t\t});\n\n\t\tit('allows existing customer to place order', async () => {\n\t\t\tawait shopper.login();\n\t\t\tawait shopper.goToShop();\n\t\t\tawait shopper.addToCartFromShopPage( productId );\n\t\t\tawait shopper.goToCheckout();\n\t\t\tawait shopper.productIsInCheckout(simpleProductName, `1`, singleProductPrice, singleProductPrice);\n\t\t\tawait shopper.fillBillingDetails(config.get('addresses.customer.billing'));\n\n\t\t\tawait uiUnblocked();\n\n\t\t\tawait expect(page).toClick('.wc_payment_method label', {text: 'Cash on delivery'});\n\t\t\tawait expect(page).toMatchElement('.payment_method_cod', {text: 'Pay with cash upon delivery.'});\n\t\t\tawait uiUnblocked();\n\t\t\tawait shopper.placeOrder();\n\n\t\t\tawait expect(page).toMatch('Order received');\n\n\t\t\t// Get order ID from the order received html element on the page\n\t\t\tlet orderReceivedHtmlElement = await page.$('.woocommerce-order-overview__order.order');\n\t\t\tlet orderReceivedText = await page.evaluate(element => element.textContent, orderReceivedHtmlElement);\n\t\t\tcustomerOrderId = orderReceivedText.split(/(\\s+)/)[6].toString();\n\t\t});\n\n\t\tit('merchant can confirm the order was received', async () => {\n\t\t\tawait merchant.login();\n\t\t\tawait merchant.verifyOrder(guestOrderId, simpleProductName, singleProductPrice, 5, fiveProductPrice);\n\t\t\tawait merchant.verifyOrder(customerOrderId, simpleProductName, singleProductPrice, 1, singleProductPrice, true);\n\t\t});\n\t});\n};\n\nmodule.exports = runCheckoutPageTest;\n"]}