{"version":3,"sources":["/Users/ronrennick/Sites/solaris/woocommerce/packages/js/e2e-core-tests/src/specs/shopper/front-end-cart-coupons.test.js"],"names":["shopper","createSimpleProduct","uiUnblocked","applyCoupon","removeCoupon","require","getCouponId","getCouponsTable","it","describe","beforeAll","runCartApplyCouponsTest","productId","emptyCart","goToShop","addToCartFromShopPage","goToCart","each","couponType","cartDiscount","orderTotal","coupon","expect","page","toMatchElement","text","waitForSelector","couponId","module","exports"],"mappings":"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","sourcesContent":["/**\n * Internal dependencies\n */\nconst {\n\tshopper,\n\tcreateSimpleProduct,\n\tuiUnblocked,\n\tapplyCoupon,\n\tremoveCoupon,\n} = require( '@woocommerce/e2e-utils' );\nconst { getCouponId, getCouponsTable } = require( '../utils/coupons' );\n\n/**\n * External dependencies\n */\nconst { it, describe, beforeAll } = require( '@jest/globals' );\n\nconst runCartApplyCouponsTest = () => {\n\tdescribe('Cart applying coupons', () => {\n\t\tlet productId;\n\n\t\tbeforeAll(async () => {\n\t\t\tproductId = await createSimpleProduct();\n\t\t\tawait shopper.emptyCart();\n\t\t\tawait shopper.goToShop();\n\t\t\tawait shopper.addToCartFromShopPage( productId );\n\t\t\tawait uiUnblocked();\n\t\t\tawait shopper.goToCart();\n\t\t});\n\n\t\tit.each( getCouponsTable() )( 'allows cart to apply %s coupon', async ( couponType, cartDiscount, orderTotal ) => {\n\t\t\tconst coupon = await getCouponId( couponType );\n\t\t\tawait applyCoupon(coupon);\n\t\t\tawait expect(page).toMatchElement('.woocommerce-message', { text: 'Coupon code applied successfully.' });\n\n\t\t\t// Verify discount applied and order total\n\t\t\tawait page.waitForSelector('.order-total');\n\t\t\tawait expect(page).toMatchElement('.cart-discount .amount', cartDiscount);\n\t\t\tawait expect(page).toMatchElement('.order-total .amount', orderTotal);\n\t\t\tawait removeCoupon(coupon);\n\t\t});\n\n\t\tit('prevents cart applying same coupon twice', async () => {\n\t\t\tconst couponId = await getCouponId( 'fixed cart' );\n\t\t\tawait applyCoupon( couponId );\n\t\t\tawait expect(page).toMatchElement('.woocommerce-message', {text: 'Coupon code applied successfully.'});\n\t\t\tawait applyCoupon( couponId );\n\t\t\t// Verify only one discount applied\n\t\t\t// This is a work around for Puppeteer inconsistently finding 'Coupon code already applied'\n\t\t\tawait expect(page).toMatchElement('.cart-discount .amount', {text: '$5.00'});\n\t\t\tawait expect(page).toMatchElement('.order-total .amount', {text: '$4.99'});\n\t\t});\n\n\t\tit('allows cart to apply multiple coupons', async () => {\n\t\t\tawait applyCoupon( await getCouponId( 'fixed product' ) );\n\t\t\tawait expect(page).toMatchElement('.woocommerce-message', {text: 'Coupon code applied successfully.'});\n\n\t\t\t// Verify discount applied and order total\n\t\t\tawait page.waitForSelector('.order-total');\n\t\t\tawait expect(page).toMatchElement('.order-total .amount', {text: '$0.00'});\n\t\t});\n\n\t\tit('restores cart total when coupons are removed', async () => {\n\t\t\tawait removeCoupon( await getCouponId( 'fixed cart' ) );\n\t\t\tawait removeCoupon( await getCouponId( 'fixed product' ) );\n\t\t\tawait expect(page).toMatchElement('.order-total .amount', {text: '$9.99'});\n\t\t});\n\t});\n};\n\nmodule.exports = runCartApplyCouponsTest;\n"]}